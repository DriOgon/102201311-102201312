import{d as e,Y as a,h as t,j as l,o as s,a as u,w as i,e as o,f as r,t as n,u as c,n as d,l as v,s as m,W as _,i as p,g as f,q as h,Q as k}from"./index-CKmb8B-R.js";import{_ as g,a as b}from"./mp-html.xHRuou5Z.js";import{o as w,a as j,r as y}from"./uni-app.es.C8008jpp.js";import{_ as x}from"./wd-icon.CKzk4z_r.js";import{s as T}from"./store.D0bvSpmK.js";import{p as C,b as L,t as O}from"./index.B98IQ2cJ.js";import{e as $}from"./commonCloud.CgNnOc-F.js";import{_ as z}from"./default-avatar.DPaE08He.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./props.DIUoDIPf.js";import"./config.defalut.Bve--ZPF.js";const E=D(e({__name:"article-details",setup(e){const D=a.database(),E=a.importObject("travel-utils",{customUI:!0}),I=t(!0),q=t(""),A=t(),B=t(""),F=t(!1),G=t(0),H=async()=>{if(!L())return;const e=Date.now();if(e-G.value<2e3)return m({title:"操作太频繁，请稍后...",icon:"none"});F.value?A.value.like_count--:A.value.like_count++,F.value=!F.value,G.value=e,$(q.value)},K=()=>{m({title:"参数有误",icon:"none"}),setTimeout((()=>{_({url:"/pages/home/home"})}),1500)};return w((()=>{var e;return{title:(null==(e=A.value)?void 0:e.title)||"旅拍路书，旅行爱好者必备旅拍记录工具",path:"/subpackages/sub_home/article-details/article-details?id="+q.value}})),j((e=>{if(!(null==e?void 0:e.id))return K();q.value=null==e?void 0:e.id,(async()=>{I.value=!0;const e=D.collection("travel-articles").where(`_id == "${q.value}"`).getTemp(),a=D.collection("uni-id-users").field("_id, username, nickname, avatar_file").getTemp(),t=D.collection("travel-like").where(`article_id == "${q.value}" && user_id == $cloudEnv_uid`).getTemp(),l=[e,a];T.hasLogin&&l.push(t),await D.collection(...l).get({getOne:!0}).then((e=>{if(!e.result.data)return K();A.value=e.result.data,B.value=C(e.result.data.content),T.hasLogin&&(F.value=!!e.result.data._id["travel-like"].length)})).catch((e=>{console.log("查询详情err---",e)})).finally((()=>{I.value=!1}))})(),(async()=>{await E.customOperation("travel-articles","view_count",q.value)})()})),(e,a)=>{const t=y(l("wd-skeleton"),g),m=p,_=f,w=h,j=y(l("mp-html"),b),T=y(l("wd-icon"),x),C=k;return s(),u(m,{class:"content"},{default:i((()=>[I.value?(s(),u(m,{key:0,class:"skeleton"},{default:i((()=>[o(t,{"row-col":[{size:"48px",type:"circle"}]}),o(t,{"custom-style":{width:"100%",marginLeft:"12px"},animation:"gradient",theme:"paragraph"})])),_:1})):(s(),u(m,{key:1},{default:i((()=>[o(m,{class:"title-bar"},{default:i((()=>[o(_,{class:"title"},{default:i((()=>[r(n(A.value.title),1)])),_:1})])),_:1}),o(m,{class:"author-bar"},{default:i((()=>{var e,a;return[o(w,{class:"avatar",src:(null==(a=null==(e=A.value.user_id[0])?void 0:e.avatar_file)?void 0:a.url)??c(z)},null,8,["src"]),o(m,{class:"author-info"},{default:i((()=>[o(_,{class:"username"},{default:i((()=>[r(n(A.value.user_id[0].nickname||A.value.user_id[0].username),1)])),_:1}),o(_,{class:"bio"},{default:i((()=>[r(n(c(O)(A.value.publish_date))+" · 发布于"+n(A.value.province),1)])),_:1})])),_:1})]})),_:1}),o(m,{class:"content-area"},{default:i((()=>[o(j,{content:B.value},null,8,["content"])])),_:1}),o(m,{class:"like-button-bar"},{default:i((()=>[o(C,{class:d(["like-button",F.value?"like-active":""]),onClick:H},{default:i((()=>[o(T,{name:"thumb-up",size:"34rpx"}),A.value.like_count>0?(s(),u(_,{key:0},{default:i((()=>[r(n(A.value.like_count),1)])),_:1})):v("",!0)])),_:1},8,["class"])])),_:1}),o(m,{class:"view-count-bar"},{default:i((()=>[o(_,{class:"view-count"},{default:i((()=>[r(n(A.value.view_count)+"人看过",1)])),_:1})])),_:1})])),_:1}))])),_:1})}}}),[["__scopeId","data-v-eb5e0ecf"]]);export{E as default};
